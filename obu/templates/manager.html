{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä</title>
    <link rel="stylesheet" href="{% static 'sty.css' %}">
</head>
<body>
    <header>
        <div class="header-left">
            <img src="{% static 'images/icon.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="header-logo">
            <h1>–ú–∞–≥–∞–∑–∏–Ω –æ–±—É–≤–∏</h1>
        </div>
        <div class="header-right">
            <span>{{ request.session.user_full_name }} (–ú–µ–Ω–µ–¥–∂–µ—Ä)</span>
            <a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>
        </div>


    </header>

    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>

        <div class="search-section">
        <form method="get" class="search-form">
            <input type="text"
                   name="q"
                   class="search-input"
                   placeholder="üîç –ü–æ–∏—Å–∫"
                   value="{{ query }}">
            <button type="submit" class="search-button">–ù–∞–π—Ç–∏</button>
            {% if query %}
                <a href="{% url 'manager_page' %}" class="clear-button">–°–±—Ä–æ—Å–∏—Ç—å</a>
            {% endif %}
        </form>

        {% if query %}
        <div class="search-results">
            –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products|length }} –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}"
        </div>
        {% endif %}
    </div>

          <div class="sort-section">
        <span class="sort-title">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–∞ —Å–∫–ª–∞–¥–µ:</span>
        <div class="sort-links">
            <a href="?{% if query %}q={{ query }}&{% endif %}sort=stock_asc"
               class="sort-link {% if sort_by == 'stock_asc' %}active{% endif %}">
                <p>üìà –ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é <span class="arrow">‚Üë</span></p>
            </a>
            <a href="?{% if query %}q={{ query }}&{% endif %}sort=stock_desc"
               class="sort-link {% if sort_by == 'stock_desc' %}active{% endif %}">
                <p>üìâ –ü–æ —É–±—ã–≤–∞–Ω–∏—é <span class="arrow">‚Üì</span></p>
            </a>
            <a href="?{% if query %}q={{ query }}{% else %}{% url 'admin_page' %}{% endif %}"
               class="sort-link {% if sort_by == 'default' %}active{% endif %}">
                –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
            </a>
        </div>
    </div>



    <!-- –í—ã–≤–æ–¥ —Ç–æ–≤–∞—Ä–æ–≤ -->
    {% for prod in products %}
    <div class="product-card {% if prod.discount_percent > 15 %}high-discount{% endif %}">
        <!-- –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ -->
        <div class="product-image">
            {% if prod.photo %}
                <img src="{% static 'images/' %}{{ prod.photo }}" alt="{{ prod.product_name }}">
            {% else %}
                <div class="no-image">
                    <img src="{% static 'images/picture.png' %}" width="150" height="150">
                </div>
            {% endif %}
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
        <div class="product-info">
            <div><b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {{ prod.category.category_name }}</div>
            <div><b>–ê—Ä—Ç–∏–∫—É–ª:</b> {{ prod.article}}</div>
            <div><b>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:</b> {{ prod.product_name }}</div>
            <div><b>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å:</b> {{ prod.producer.producer_name }}</div>
            <div><b>–ü–æ—Å—Ç–∞–≤—â–∏–∫:</b> {{ prod.provider.provider_name }}</div>
            <div><b>–ï–¥. –∏–∑–º–µ—Ä–µ–Ω–∏—è:</b> {{ prod.unit.unit_name }}</div>

            <div>
                <b>–¶–µ–Ω–∞:</b>
                {% if prod.discount_percent > 0 %}
                    <span class="price-old">{{ prod.price|floatformat:2 }} —Ä—É–±.</span>
                    <span class="price-new">{{ prod.discounted_price|floatformat:2 }} —Ä—É–±.</span>
                {% else %}
                    <span class="price-new">{{ prod.price|floatformat:2 }} —Ä—É–±.</span>
                {% endif %}
            </div>

            <div>
                <b>–ù–∞ —Å–∫–ª–∞–¥–µ:</b>
                {% if prod.stock_quantity == 0 %}
                    <span class="out-of-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                {% elif prod.stock_quantity < 5 %}
                    <span style="color: #ff9800;">{{ prod.stock_quantity }} —à—Ç. (–æ—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ)</span>
                {% else %}
                    <span>{{ prod.stock_quantity }} —à—Ç.</span>
                {% endif %}
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
            {% if prod.description %}
            <div style="margin-top: 10px; font-style: italic; color: #666;">
                {{ prod.description }}
            </div>
            {% endif %}

        </div>

        <!-- –ë–µ–π–¥–∂ —Å–æ —Å–∫–∏–¥–∫–æ–π -->
        {% if prod.discount_percent > 0 %}
        <div class="discount-badge">
            -{{ prod.discount_percent }}%
        </div>
        {% endif %}
    </div>
    {% empty %}
    <div class="empty-catalog">
        <h3>–í –∫–∞—Ç–∞–ª–æ–≥–µ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</h3>
    </div>
    {% endfor %}
</body>
</html>